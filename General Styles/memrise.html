<div class=ankiCard>
  {{Question}}<br><br>
  
  <div id="hide">
    {{type:Answer}}
    <div id="Answer">{{Answer}}</div>
    <div id="ID">{{ID}}</div>
    <div id="Choices">{{Choices}}</div>
  </div>
  
  <div class="multi">
    <button id=1></button>
    <button id=2></button>
    <button id=3></button>
    <button id=4></button>
    <button id=5></button> 
    <button id=6></button>
  </div>
  
</div>

<script>
  (function (){
    // Get cards
    var cards = document.getElementsByClassName("ankiCard");
    // Loop through each card (for compatibility with AnkiWeb
    for (var c=0; c<cards.length; c++){
      card = cards[c];
      
      // Get values from hidden fields
      var Answer = document.getElementById("Answer").textContent;
      var id = document.getElementById("ID").textContent;
      var choices = document.getElementById("Choices").textContent;
      
      // Store the 6 multiple choice buttons as an array
      var buttons=card.getElementsByTagName('button');
      
      // Create a seed value from today's date and the card ID.
      var d = new Date();
      var dateSeed = d.getYear() * 10000 + d.getMonth() * 100 + d.getDate();
      var seed = ankiRand(dateSeed*id - id);
      if(seed==0){
        seed= ankiRand(1);
      }
      
      // Split the choices field by "|" and store it in an array. Assign a random value to each choice
      var mcRaw = choices.split("|");
      var mcRand = [];
      var rand = seed;
      for (var i=0; i<mcRaw.length; i++){
        rand = ankiRand(rand);
        mcRand.push([mcRaw[i], rand]);
      }
      
      // Sort the choice array and split off the first 5 choices if there are more than 5.
      mcRand.sort(sortFunction);
      if(mcRand.length > 5){
        var mcSort = mcRand.splice(0,5);
      }else{
        mcSort = mcRand;
      }
      
      // insert the correct answer as a choice
      var buttonVal = [];
      var hasAnswer = false;
      var len = mcSort.length;
      var ansLoc = Math.floor(seed*(len+1));
      for (var i=0; i<len; i++){
        if(i>= ansLoc && !hasAnswer){
          buttonVal.push(Answer);
          hasAnswer = true;
        }
        buttonVal.push(mcSort[i][0]);
      }
      if(!hasAnswer){
        buttonVal.push(Answer);
      }
      
      // Write the choices to the buttons, hide the buttons with no choices
      for (var i=0; i<buttons.length; i++){
        if(i<buttonVal.length){
          buttons[i].innerText = buttonVal[i];
        }else{
          buttons[i].parentElement.style.display = "none";
        }
      }
      
      
      // Only run if front side:
      if(card.getElementsByTagName("CODE").length == 0 && c == 0){
        // Make the buttons work
        for(var i=0; i<buttons.length; i++){
          buttons[i].onclick = clickFunction;
        }
      }else{
        // Only run if back side:
        // Style the buttons for correct answers.
        buttons[ansLoc].className += "good";
        
        // Style the buttons for incorrect answers.
        // The "CODE" tag is generated by Anki from the type:Answer field
        var Compare = card.getElementsByTagName("CODE");
        if(Compare.length == 0){break;}
        var CompareElems = Compare[0].getElementsByTagName("*");
        if (CompareElems[0] !=null){
          var Answered = CompareElems[0].textContent;
          if(ansLoc != Answered - 1){
            buttons[Answered-1].className += "bad";
          }
        }
      }// End back side Only
    }//End card loop
    
    function clickFunction(){
      // Write the button's text into the type:Answer field.
      var input =  document.getElementById("Answer");
      input.value = this.id;
      
      // Simulate pressing enter on the input field.
      var ev = document.createEvent('Event');
      ev.initEvent('keypress');
      ev.which = ev.keyCode = 13;
      input.dispatchEvent(ev);
    }
    
    function ankiRand(seed){
      var rand = (seed * 73) % 59;
      return rand / 59;
    }
    
    function sortFunction(a, b) {
      if (a[1] === b[1]) {
        return 0;
      }
      else {
        return (a[1] < b[1]) ? -1 : 1;
      }
    }
  })()
</script>
